(()=>{function a(){document.forms[0].submit()}function f(){document.getElementById("error").classList.remove("hidden")}function g(e){return document.cookie.match("(^|;)\\s*open_id_"+e.state)}function w(e,r){return new Promise((c,i)=>{let t=new URL(r.oidc_url).origin,n=r.target,s=window.parent||window.opener,l=n==="_parent"?s:s.frames[n];r.origin_support_broken&&(t="*");let u=setTimeout(()=>{console.log("postMessage timeout"),i(new Error("Timeout while waiting for platform response"))},2e3),d=o=>{typeof o.data=="object"&&o.data.subject==="lti.get_data.response"&&o.data.message_id===e&&(o.origin===t||t==="*")&&(removeEventListener("message",d),clearTimeout(u),o.data.error&&(console.log(o.data.error.code),console.log(o.data.error.message),i(new Error(o.data.errormessage))),c(o.data.value))};window.addEventListener("message",d),l.postMessage({subject:"lti.get_data",message_id:e,key:"atomic_lti_"+e},t)})}async function m(e){if(g(e)||!e.require_csrf)return a();if(e.lti_storage_params)try{let r=await w(e.state,e.lti_storage_params);return document.getElementsByName("csrf_token")[0].value=r,a()}catch(r){console.log(r),f()}a()}window.onload=async()=>m(window.SETTINGS);})();
